version: "3.9"
services:
  post.service:
    container_name: post.service
    image: ${DOCKER_REGISTRY-}postservice
    build:
      context: .
      dockerfile: PostService/Dockerfile
    networks: 
      - system-design
    environment:
      - ConnectionStrings__CosmosDB=AccountEndpoint=https://dev-jrc-bna-cosmos-db-aue.documents.azure.com:443/;AccountKey=7rn1L01xPCmbKs2u8hNyNH2qWk3yQGQTb4gN7FJJrE4mZAGJQcE7wx8FbF1RMLrbdaJgGyQN2pNWaAWNUaNnUw==
      - AssetService=http://web.apigateway/assets

  asset.service:
    container_name: asset.service
    image: ${DOCKER_REGISTRY-}assetservice
    build:
      context: .
      dockerfile: AssetService/Dockerfile
    networks: 
      - system-design
    environment:
      - AzureWebJobsStorage=DefaultEndpointsProtocol=https;AccountName=simadfutilityfuncaue;AccountKey=S3a3RBEnzDqPv/IWYy2njQB5TXIOnvnQbSLw1WK4oaM3c8qG4cfA8g+ub5glW2qClVMGT5izM5tz+ASt3MqyyQ==;EndpointSuffix=core.windows.net
      - StorageAccountName=simadfutilityfuncaue
      - StorageAccountKey=S3a3RBEnzDqPv/IWYy2njQB5TXIOnvnQbSLw1WK4oaM3c8qG4cfA8g+ub5glW2qClVMGT5izM5tz+ASt3MqyyQ==

  reaction.service:
    container_name: reaction.service
    image: ${DOCKER_REGISTRY-}reactionservice
    build:
      context: .
      dockerfile: LikeService/Dockerfile
    networks: 
      - system-design
    environment:
      - ConnectionStrings__CosmosDB=AccountEndpoint=https://dev-jrc-bna-cosmos-db-aue.documents.azure.com:443/;AccountKey=7rn1L01xPCmbKs2u8hNyNH2qWk3yQGQTb4gN7FJJrE4mZAGJQcE7wx8FbF1RMLrbdaJgGyQN2pNWaAWNUaNnUw==
      - ConnectionStrings__ServiceBus=Endpoint=sb://staging-jrc-bna-services-aue.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=w/uUf0Ta/UBao4jxjci4SvYEVBdxH/z/L8nrregrNq0=

  web.apigateway:
    container_name: web.apigateway
    image: ${DOCKER_REGISTRY-}webapigateway
    build:
      context: .
      dockerfile: WebApiGateway/Dockerfile
    environment: 
      - ASPNETCORE_URLS=http://+:80
    ports:
      - 8082:80
    networks: 
      - system-design
    mem_limit: 100M
    mem_reservation: 50M

volumes:
  data01:
    driver: local

networks: 
  system-design:
    driver: bridge